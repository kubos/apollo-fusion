version: 2
jobs:
    os_build:
      docker:
        - image: kubos/kubos-linux-dev:latest
      working_directory: ~/project/apollo-fusion
      steps:
        - checkout
        - run: ./build.sh | tee full_build.log
        # Note: store_artifacts will trigger a failure when `circleci build` is run locally
        - store_artifacts:
            path: full_build.log
        - store_artifacts:
            path: kubos-linux.tar.gz
        - store_artifacts:
            path: aux-sd.tar.gz
    apps_build:
      docker:
        - image: kubos/kubos-dev:latest
      working_directory: ~/project/apollo-fusion/apps
      steps:
        - checkout
        - run: cargo build
    apps_clippy:
      docker:
        - image: kubos/kubos-dev:latest
      working_directory: ~/project/apollo-fusion/apps
      steps:
        - checkout
        - run: cargo clippy
    rust_fmt:
      docker:
        - image: kubos/kubos-dev:latest
      working_directory: ~/project/apollo-fusion/apps
      steps:
        - checkout
        - run: cargo fmt -- --check