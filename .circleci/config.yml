version: 2
jobs:
    build_af:
      docker:
        - image: kubos/kubos-linux-dev:latest
      working_directory: ~/project/apollo-fusion
      steps:
        - checkout
        - run: ./build.sh | tee full_build.log
        # Note: store_artifacts will trigger a failure when `circleci build` is run locally
        - store_artifacts:
            path: full_build.log
        - store_artifacts:
            path: kubos-linux.tar.gz
        - store_artifacts:
            path: aux-sd.tar.gz
    # TODO: Add build/test case for verifying the mission application/s compile successfully
    # (Depends on mission app being added to this repo)
    
workflows:
  version: 2
  build:
    jobs:
      - build_af:
          filters:
            tags:
              only: /^[0-9]+(\.[0-9]+)*$/
            branches:
              ignore: master